<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "head_common" .}}
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
</head>
<body>
    <div class="app-container">
        {{template "sidebar" .}}
        <main class="main-content">
            {{template "topbar" .}}
            <div class="content">
                {{if .Error}}
                <div class="alert alert-error">{{.Error}}</div>
                {{end}}

                {{$rev := index .Revisions 0}}
                <div class="doc-container">
                    <div class="doc-main">
                        <div class="page-header">
                            <div class="page-header-row">
                                <h2>{{.Document.Title}}</h2>
                                <div class="doc-actions">
                                    <a href="/docs/{{.Document.Path}}" class="btn btn-primary">View Current</a>
                                    <a href="/docs/id/{{.Document.ID}}/history" class="btn btn-secondary">Back to History</a>
                                </div>
                            </div>
                            <div class="doc-meta">
                                <span class="doc-path"><code>{{.Document.Path}}</code></span>
                                <span class="badge badge-warning">Viewing Revision</span>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <strong>Historical Version</strong> â€” This is a previous revision from 
                            {{$rev.CreatedAt.Format "Jan 2, 2006 3:04 PM"}}.
                            {{if $rev.Message}}<br>Message: "{{$rev.Message}}"{{end}}
                        </div>

                        <div class="card doc-content">
                            <div class="markdown-body">
                                {{.RenderedBody}}
                            </div>
                        </div>
                    </div>

                    <aside class="doc-sidebar">
                        <div class="card">
                            <h4>Revision Info</h4>
                            <dl class="meta-list">
                                <dt>Created</dt>
                                <dd>{{$rev.CreatedAt.Format "Jan 2, 2006 3:04 PM"}}</dd>
                                {{if $rev.Author}}
                                <dt>Author</dt>
                                <dd>{{$rev.Author.Name}}</dd>
                                {{end}}
                                {{if $rev.Message}}
                                <dt>Message</dt>
                                <dd>{{$rev.Message}}</dd>
                                {{end}}
                            </dl>
                        </div>

                        {{if .Membership.IsEditor}}
                        <div class="card">
                            <h4>Actions</h4>
                            <form action="/docs/id/{{.Document.ID}}/revert/{{$rev.ID}}" method="POST" 
                                  onsubmit="return confirm('Revert to this revision? This will create a new revision with this content.')">
                                {{.CSRFField}}
                                <button type="submit" class="btn btn-warning btn-block">Revert to This Version</button>
                            </form>
                            <p class="form-help" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                                This will create a new revision with the content from this version.
                            </p>
                        </div>
                        {{end}}
                    </aside>
                </div>

            </div>
        </main>
    </div>
{{template "page_scripts" .}}
</body>
</html>
