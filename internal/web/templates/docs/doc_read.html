{{define "doc_read.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "head_common" .}}
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
</head>
<body>
    <div class="app-container">
        {{template "sidebar" .}}
        <main class="main-content">
            {{template "topbar" .}}
            <div class="content">
                {{template "alerts" .}}

                <nav class="breadcrumbs">
                    <a href="/docs">Docs</a>
                    <span class="separator">/</span>
                    {{.Document.Title}}
                </nav>

                <div class="doc-container">
                    <div class="doc-main">
                        <div class="page-header">
                            <div class="page-header-row">
                                <h2>{{.Document.Title}}</h2>
                                <div class="doc-actions">
                                    {{if $.Membership.IsEditor}}
                                    <a href="/docs/id/{{.Document.ID}}/edit" class="btn btn-primary">Edit</a>
                                    {{end}}
                                    <a href="/docs/id/{{.Document.ID}}/history" class="btn btn-secondary">History</a>
                                    <a href="/docs/id/{{.Document.ID}}/attachments" class="btn btn-secondary">Attachments</a>
                                    {{if $.Membership.IsEditor}}
                                    <a href="/docs/id/{{.Document.ID}}/rename" class="btn btn-secondary">Rename</a>
                                    <form action="/docs/id/{{.Document.ID}}/delete" method="POST" style="display: inline;">
                                        {{$.CSRFField}}
                                        <button type="submit" class="btn btn-danger"
                                            data-confirm="This will permanently delete this document and all its revisions. This cannot be undone."
                                            data-confirm-title="Delete Document?">Delete</button>
                                    </form>
                                    {{end}}
                                </div>
                            </div>
                            <div class="doc-meta">
                                <span class="doc-path"><code>{{.Document.Path}}</code></span>
                                {{if eq .Document.DocType "runbook"}}
                                <span class="badge badge-warning">Runbook</span>
                                {{end}}
                                {{if .Document.Client}}
                                <span class="doc-client">Client: <a href="/clients/{{.Document.Client.ID}}">{{.Document.Client.Name}}</a></span>
                                {{end}}
                            </div>
                        </div>

                        <div class="card doc-content">
                            <div class="markdown-body">
                                {{.RenderedBody}}
                            </div>
                        </div>
                    </div>

                    <aside class="doc-sidebar">
                        {{if eq .Document.DocType "runbook"}}
                        <div class="card {{if .RunbookOverdue}}card-danger{{end}}">
                            <h4>Runbook Status</h4>
                            {{if .RunbookStatus}}
                            <dl class="meta-list">
                                <dt>Status</dt>
                                <dd>
                                    {{if .RunbookOverdue}}
                                    <span class="badge badge-danger">Overdue</span>
                                    {{else if .RunbookStatus.LastVerifiedAt}}
                                    <span class="badge badge-success">Verified</span>
                                    {{else}}
                                    <span class="badge badge-warning">Not Verified</span>
                                    {{end}}
                                </dd>
                                {{if .RunbookStatus.LastVerifiedAt}}
                                <dt>Last Verified</dt>
                                <dd>{{.RunbookStatus.LastVerifiedAt.Format "Jan 2, 2006"}}</dd>
                                {{end}}
                                {{if .RunbookStatus.NextDueAt}}
                                <dt>Next Due</dt>
                                <dd class="{{if .RunbookOverdue}}text-danger{{end}}">{{.RunbookStatus.NextDueAt.Format "Jan 2, 2006"}}</dd>
                                {{end}}
                                <dt>Interval</dt>
                                <dd>{{.RunbookStatus.VerificationIntervalDays}} days</dd>
                            </dl>
                            {{if $.Membership.IsEditor}}
                            <form action="/docs/id/{{.Document.ID}}/verify" method="POST" style="margin-top: 1rem;">
                                {{.CSRFField}}
                                <button type="submit" class="btn btn-success btn-block">Mark as Verified</button>
                            </form>
                            {{end}}
                            {{else}}
                            {{if $.Membership.IsEditor}}
                            <p class="text-muted">Not yet configured for verification.</p>
                            <form action="/docs/id/{{.Document.ID}}/verify" method="POST">
                                {{.CSRFField}}
                                <button type="submit" class="btn btn-success btn-block">Start Verification Tracking</button>
                            </form>
                            {{end}}
                            {{end}}
                        </div>
                        {{end}}

                        <div class="card">
                            <h4>Document Info</h4>
                            <dl class="meta-list">
                                <dt>Created</dt>
                                <dd>{{.Document.CreatedAt.Format "Jan 2, 2006"}}</dd>
                                <dt>Updated</dt>
                                <dd>{{.Document.UpdatedAt.Format "Jan 2, 2006 3:04 PM"}}</dd>
                                {{if .Document.Owner}}
                                <dt>Owner</dt>
                                <dd>{{.Document.Owner.Name}}</dd>
                                {{end}}
                                {{if .Document.CurrentRevision}}
                                {{if .Document.CurrentRevision.Author}}
                                <dt>Last edited by</dt>
                                <dd>{{.Document.CurrentRevision.Author.Name}}</dd>
                                {{end}}
                                {{end}}
                            </dl>
                        </div>
                    </aside>
                </div>

            </div>
        </main>
    </div>
{{template "page_scripts" .}}
</body>
</html>
{{end}}
