{{define "doc_health.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{template "head_common" .}}
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
</head>
<body>
    <div class="app-container">
        {{template "sidebar" .}}
        <main class="main-content">
            {{template "topbar" .}}
            <div class="content">
                {{template "alerts" .}}

                <div class="breadcrumbs">
                    <a href="/">Dashboard</a>
                    <span class="separator">/</span>
                    <span>Doc Health</span>
                </div>

                <div class="page-header">
                    <h2>üìä Doc Health</h2>
                </div>

                {{with .Content}}
                {{with .Summary}}
                <div class="dashboard-stats health-stats">
                    <div class="stat-card">
                        <div class="stat-number">{{.TotalDocs}}</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-card {{if gt $.Content.HealthPct 70}}stat-card-success{{else if gt $.Content.HealthPct 40}}stat-card-warning{{else}}stat-card-warning{{end}}">
                        <div class="stat-number">{{$.Content.HealthPct}}%</div>
                        <div class="stat-label">Healthy</div>
                    </div>
                    <div class="stat-card {{if .StaleDocs}}stat-card-warning{{end}}">
                        <div class="stat-number">{{len .StaleDocs}}</div>
                        <div class="stat-label">Stale (&gt;{{$.Content.StaleDays}}d)</div>
                    </div>
                    <div class="stat-card {{if .UnownedDocs}}stat-card-warning{{end}}">
                        <div class="stat-number">{{len .UnownedDocs}}</div>
                        <div class="stat-label">Unowned</div>
                    </div>
                    <div class="stat-card {{if $.Content.BrokenLinks}}stat-card-warning{{end}}">
                        <div class="stat-number">{{len $.Content.BrokenLinks}}</div>
                        <div class="stat-label">Broken Links</div>
                    </div>
                </div>

                {{if .StaleDocs}}
                <section class="card dashboard-section">
                    <h3>‚è∞ Stale Documents</h3>
                    <p class="text-muted" style="margin-top: 0; margin-bottom: 12px;">Not updated in over {{$.Content.StaleDays}} days</p>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Path</th>
                                    <th>Client</th>
                                    <th>Owner</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .StaleDocs}}
                                <tr>
                                    <td><a href="/docs/{{.Path}}">{{.Title}}</a></td>
                                    <td><code>{{.Path}}</code></td>
                                    <td>{{if .Client}}{{.Client.Name}}{{else}}<span class="text-muted">&mdash;</span>{{end}}</td>
                                    <td>{{if .Owner}}{{.Owner.Name}}{{else}}<span class="badge badge-warning">No owner</span>{{end}}</td>
                                    <td>{{timeTag .UpdatedAt "Jan 2, 2006"}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </section>
                {{else}}
                <section class="card dashboard-section">
                    <h3>‚è∞ Stale Documents</h3>
                    <div class="empty-state" style="padding: 24px;">
                        <p>‚úÖ No stale documents. Great job keeping things current!</p>
                    </div>
                </section>
                {{end}}

                {{if .UnownedDocs}}
                <section class="card dashboard-section">
                    <h3>üë§ Unowned Documents</h3>
                    <p class="text-muted" style="margin-top: 0; margin-bottom: 12px;">Documents without an assigned owner</p>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Path</th>
                                    <th>Client</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .UnownedDocs}}
                                <tr>
                                    <td><a href="/docs/{{.Path}}">{{.Title}}</a></td>
                                    <td><code>{{.Path}}</code></td>
                                    <td>{{if .Client}}{{.Client.Name}}{{else}}<span class="text-muted">&mdash;</span>{{end}}</td>
                                    <td>{{timeTag .UpdatedAt "Jan 2, 2006"}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </section>
                {{else}}
                <section class="card dashboard-section">
                    <h3>üë§ Unowned Documents</h3>
                    <div class="empty-state" style="padding: 24px;">
                        <p>‚úÖ All documents have owners assigned.</p>
                    </div>
                </section>
                {{end}}

                {{if .BrokenLinks}}
                <section class="card dashboard-section">
                    <h3>‚ö†Ô∏è Broken Links</h3>
                    <p class="text-muted" style="margin-top: 0; margin-bottom: 12px;">Internal document links pointing to non-existent paths</p>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>From Document</th>
                                    <th>Broken Link Target</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .BrokenLinks}}
                                <tr>
                                    <td><a href="/docs/{{.FromPath}}">{{.FromTitle}}</a></td>
                                    <td><code>{{.LinkPath}}</code></td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </section>
                {{else}}
                <section class="card dashboard-section">
                    <h3>‚ö†Ô∏è Broken Links</h3>
                    <div class="empty-state" style="padding: 24px;">
                        <p>‚úÖ No broken internal links found.</p>
                    </div>
                </section>
                {{end}}

                {{end}}
                {{end}}
            </div>
        </main>
    </div>
{{template "page_scripts" .}}
</body>
</html>
{{end}}
